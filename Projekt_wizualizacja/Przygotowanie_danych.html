<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Przygotowanie danych</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="Przygotowanie_danych_files/libs/clipboard/clipboard.min.js"></script>
<script src="Przygotowanie_danych_files/libs/quarto-html/quarto.js"></script>
<script src="Przygotowanie_danych_files/libs/quarto-html/popper.min.js"></script>
<script src="Przygotowanie_danych_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Przygotowanie_danych_files/libs/quarto-html/anchor.min.js"></script>
<link href="Przygotowanie_danych_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Przygotowanie_danych_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Przygotowanie_danych_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Przygotowanie_danych_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Przygotowanie_danych_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Przygotowanie danych</h1>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
    
      
    </div>
    
  
  </header><div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Spis treści</h2>
   
  <ul>
  <li><a href="#scrapowanie-danych" id="toc-scrapowanie-danych" class="nav-link active" data-scroll-target="#scrapowanie-danych">Scrapowanie danych</a>
  <ul class="collapse">
  <li><a href="#usunięcie-zbędnych-kolumn-wierszy-i-obserwacji" id="toc-usunięcie-zbędnych-kolumn-wierszy-i-obserwacji" class="nav-link" data-scroll-target="#usunięcie-zbędnych-kolumn-wierszy-i-obserwacji">1) Usunięcie zbędnych kolumn, wierszy i obserwacji</a></li>
  <li><a href="#naprawa-błędów" id="toc-naprawa-błędów" class="nav-link" data-scroll-target="#naprawa-błędów">2) Naprawa błędów</a></li>
  <li><a href="#uzupełnienie-braków" id="toc-uzupełnienie-braków" class="nav-link" data-scroll-target="#uzupełnienie-braków">3) Uzupełnienie braków</a></li>
  <li><a href="#zmiana-typów" id="toc-zmiana-typów" class="nav-link" data-scroll-target="#zmiana-typów">4) Zmiana typów</a></li>
  <li><a href="#tworzenie-dodatkowej-kolumny---age_group" id="toc-tworzenie-dodatkowej-kolumny---age_group" class="nav-link" data-scroll-target="#tworzenie-dodatkowej-kolumny---age_group">5) Tworzenie dodatkowej kolumny - Age_Group</a></li>
  <li><a href="#tworzenie-dodatkowej-ramki" id="toc-tworzenie-dodatkowej-ramki" class="nav-link" data-scroll-target="#tworzenie-dodatkowej-ramki">6) Tworzenie dodatkowej ramki</a></li>
  <li><a href="#zapis-gotowych-ramek" id="toc-zapis-gotowych-ramek" class="nav-link" data-scroll-target="#zapis-gotowych-ramek">7) Zapis gotowych ramek</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content quarto-banner-title-block" id="quarto-document-content">




<section id="scrapowanie-danych" class="level1">
<h1>Scrapowanie danych</h1>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Scrapping</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">fb_big5_advanced_season_stats</span>(<span class="at">season_end_year=</span> <span class="dv">2018</span><span class="sc">:</span><span class="dv">2025</span>, <span class="at">stat_type=</span> <span class="st">"shooting"</span>, <span class="at">team_or_player=</span> <span class="st">"player"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Struktura danych:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Wizualizacja 6 pierwszych wierszy</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  Season_End_Year  Squad    Comp               Player Nation   Pos Age Born
1            2018 Alavés La Liga Martin Agirregabiria    ESP    DF  21 1996
2            2018 Alavés La Liga               Alexis    ESP    DF  31 1985
3            2018 Alavés La Liga               Burgui    ESP MF,FW  23 1993
4            2018 Alavés La Liga    Ermedin Demirović    BIH    FW  19 1998
5            2018 Alavés La Liga       Adrián Diéguez    ESP    DF  21 1996
6            2018 Alavés La Liga         Rubén Duarte    ESP    DF  21 1995
  Mins_Per_90 Gls_Standard Sh_Standard SoT_Standard SoT_percent_Standard
1        20.3            0           3            1                 33.3
2        24.3            1          13            3                 23.1
3        11.5            1          15            4                 26.7
4         2.0            1           6            3                 50.0
5         4.8            0           3            0                  0.0
6        23.8            0           8            0                  0.0
  Sh_per_90_Standard SoT_per_90_Standard G_per_Sh_Standard G_per_SoT_Standard
1               0.15                0.05              0.00               0.00
2               0.54                0.12              0.08               0.33
3               1.31                0.35              0.07               0.25
4               2.97                1.48              0.17               0.33
5               0.62                0.00              0.00                 NA
6               0.34                0.00              0.00                 NA
  Dist_Standard FK_Standard PK_Standard PKatt_Standard xG_Expected
1          36.8           0           0              0         0.1
2          13.7           0           0              0         1.2
3          22.6           1           0              0         0.7
4          12.7           0           0              0         1.7
5          25.4           0           0              0         0.1
6          22.7           0           0              0         0.8
  npxG_Expected npxG_per_Sh_Expected G_minus_xG_Expected np:G_minus_xG_Expected
1           0.1                 0.02                -0.1                   -0.1
2           1.2                 0.09                -0.2                   -0.2
3           0.7                 0.05                 0.3                    0.3
4           1.7                 0.29                -0.7                   -0.7
5           0.1                 0.03                -0.1                   -0.1
6           0.8                 0.10                -0.8                   -0.8
                                                         Url
1 https://fbref.com/en/players/355c883a/Martin-Agirregabiria
2               https://fbref.com/en/players/db0cd1ae/Alexis
3               https://fbref.com/en/players/45e304c8/Burgui
4    https://fbref.com/en/players/ed79b7d3/Ermedin-Demirovic
5       https://fbref.com/en/players/70438d35/Adrian-Dieguez
6         https://fbref.com/en/players/1fe0492d/Ruben-Duarte</code></pre>
</div>
</div>
<section id="usunięcie-zbędnych-kolumn-wierszy-i-obserwacji" class="level3">
<h3 class="anchored" data-anchor-id="usunięcie-zbędnych-kolumn-wierszy-i-obserwacji">1) Usunięcie zbędnych kolumn, wierszy i obserwacji</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Usuniecie ostatniej kolumny</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data[, <span class="sc">-</span><span class="fu">ncol</span>(data)]</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Usuniecie innych nieporzebnych kolumn</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>Born, <span class="sc">-</span>Mins_Per_90, <span class="sc">-</span>SoT_Standard, <span class="sc">-</span>Sh_per_90_Standard, </span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>         <span class="sc">-</span>SoT_per_90_Standard, <span class="sc">-</span>G_per_Sh_Standard, <span class="sc">-</span>G_per_SoT_Standard, </span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>         <span class="sc">-</span>FK_Standard, <span class="sc">-</span>SoT_percent_Standard, <span class="sc">-</span>PK_Standard,<span class="sc">-</span>PKatt_Standard,</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>         <span class="sc">-</span>npxG_per_Sh_Expected, <span class="sc">-</span>npxG_Expected, <span class="sc">-</span><span class="st">"np:G_minus_xG_Expected"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Jako, że analiza będzie dotyczyła statystyk związanych ze strzałami, zdecydowałem się odrzucić wszystkich piłkarzy grających na pozycji bramkarza, oddali oni zaledwie 65 strzałów co w parównaniu do 332 175 oddanych przez piłkarzy grających na innych pozycjach stanowi zaledwie 0,02% wszystkich strzałów.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Usunięcie bramkarzy</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Pos <span class="sc">!=</span> <span class="st">"GK"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Oraz obserwacje zawierające wartości Na w kolumnie “G_minus_xG_Expected”</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Usunięcie obserwacji z G_minus_xG_Expected = Na</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(G_minus_xG_Expected))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="naprawa-błędów" class="level3">
<h3 class="anchored" data-anchor-id="naprawa-błędów">2) Naprawa błędów</h3>
<p>Widać także, że część obserwacji zawiera 2 pozycje (chodzi o kolumne “Pos”). Jednak po przeanalizowaniu tych przypadków za optymalne uważam zostawienie tylko tej, która występuje jako pierwsza. To ona definiuje pozycje, na której zawodnik występuje częściej lub lepiej oddaje specyfikę pozycji, na której dany piłkarz występuje.</p>
<p>Przykładowo, dwie pozycje w kolumnie “Pos” zawierają Vinicius Júnior, który w różnych zestawieniach jest traktowany zdecydowanie częściej jako napastnik niż jako pomocnik. Podobnie sytuacja wygląda w innych przypadkach.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Wizualizacja wierszy, gdzie Vinicius Junior zawiera dwi pozycje</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>data[data<span class="sc">$</span>Player <span class="sc">==</span> <span class="st">"Vinicius Júnior"</span> <span class="sc">&amp;</span> data<span class="sc">$</span>Pos <span class="sc">==</span> <span class="st">"FW,MF"</span> <span class="sc">&amp;</span> data<span class="sc">$</span>Season_End_Year <span class="sc">==</span> <span class="dv">2020</span>, <span class="fu">c</span>(<span class="st">"Player"</span>, <span class="st">"Pos"</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>              Player   Pos
6790 Vinicius Júnior FW,MF</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Zmiana komórek, gdzie znajdują się 2 pozycje</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Pos =</span> <span class="fu">case_when</span>(</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    Pos <span class="sc">==</span> <span class="st">"DF,FW"</span> <span class="sc">~</span> <span class="st">"DF"</span>,</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    Pos <span class="sc">==</span> <span class="st">"DF,MF"</span> <span class="sc">~</span> <span class="st">"DF"</span>,</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    Pos <span class="sc">==</span> <span class="st">"FW,DF"</span> <span class="sc">~</span> <span class="st">"FW"</span>,</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    Pos <span class="sc">==</span> <span class="st">"FW,MF"</span> <span class="sc">~</span> <span class="st">"FW"</span>,</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    Pos <span class="sc">==</span> <span class="st">"MF,DF"</span> <span class="sc">~</span> <span class="st">"MF"</span>,</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    Pos <span class="sc">==</span> <span class="st">"MF,FW"</span> <span class="sc">~</span> <span class="st">"MF"</span>,</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> Pos))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Ramka danych zawiera błędy w kolumnie “Age” w niektórych obserwacjach oprócz wieku w latach zecrappowane zostały także dni po myślniku, usuwam je gdyż nie przydadzą się one w analizie.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Usunięcie "-" i wszystkiego co występuje po nim</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>Age <span class="ot">&lt;-</span> <span class="fu">sub</span>(<span class="st">"-.*"</span>, <span class="st">""</span>, data<span class="sc">$</span>Age)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="uzupełnienie-braków" class="level3">
<h3 class="anchored" data-anchor-id="uzupełnienie-braków">3) Uzupełnienie braków</h3>
<p>Zauważyłem także, że ramka zawiera braki</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Sprawdzenie braków</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colSums</span>(data <span class="sc">==</span> <span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>    Season_End_Year               Squad                Comp              Player 
                  0                   0                   0                   0 
             Nation                 Pos                 Age        Gls_Standard 
                 14                   0                   7                   0 
        Sh_Standard       Dist_Standard         xG_Expected G_minus_xG_Expected 
                  0                  NA                   0                   0 </code></pre>
</div>
</div>
<p>Jako, że jest ich jedynie 32 zdecydowałem się uzupełnić braki ręcznie</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Uzupełnienie narodowości</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>Nation[data<span class="sc">$</span>Season_End_Year <span class="sc">==</span> <span class="dv">2018</span> <span class="sc">&amp;</span> data<span class="sc">$</span>Player <span class="sc">==</span> <span class="st">"Christian Rutjens"</span>] <span class="ot">&lt;-</span> <span class="st">"ESP"</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>Nation[data<span class="sc">$</span>Season_End_Year <span class="sc">==</span> <span class="dv">2018</span> <span class="sc">&amp;</span> data<span class="sc">$</span>Player <span class="sc">==</span> <span class="st">"Anthony Walongwa"</span>] <span class="ot">&lt;-</span> <span class="st">"COD"</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>Nation[data<span class="sc">$</span>Season_End_Year <span class="sc">==</span> <span class="dv">2019</span> <span class="sc">&amp;</span> data<span class="sc">$</span>Player <span class="sc">==</span> <span class="st">"Anthony Walongwa"</span>] <span class="ot">&lt;-</span> <span class="st">"COD"</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>Nation[data<span class="sc">$</span>Season_End_Year <span class="sc">==</span> <span class="dv">2019</span> <span class="sc">&amp;</span> data<span class="sc">$</span>Player <span class="sc">==</span> <span class="st">"Alessio da Cruz"</span>] <span class="ot">&lt;-</span> <span class="st">"CPV"</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>Nation[data<span class="sc">$</span>Season_End_Year <span class="sc">==</span> <span class="dv">2019</span> <span class="sc">&amp;</span> data<span class="sc">$</span>Player <span class="sc">==</span> <span class="st">"Hakim El Mokeddem"</span>] <span class="ot">&lt;-</span> <span class="st">"FRA"</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>Nation[data<span class="sc">$</span>Season_End_Year <span class="sc">==</span> <span class="dv">2020</span> <span class="sc">&amp;</span> data<span class="sc">$</span>Player <span class="sc">==</span> <span class="st">"Sinan Gümüş"</span>] <span class="ot">&lt;-</span> <span class="st">"GER"</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>Nation[data<span class="sc">$</span>Season_End_Year <span class="sc">==</span> <span class="dv">2021</span> <span class="sc">&amp;</span> data<span class="sc">$</span>Player <span class="sc">==</span> <span class="st">"Atakan Karazor"</span>] <span class="ot">&lt;-</span> <span class="st">"GER"</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>Nation[data<span class="sc">$</span>Season_End_Year <span class="sc">==</span> <span class="dv">2022</span> <span class="sc">&amp;</span> data<span class="sc">$</span>Player <span class="sc">==</span> <span class="st">"Atakan Karazor"</span>] <span class="ot">&lt;-</span> <span class="st">"GER"</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>Nation[data<span class="sc">$</span>Season_End_Year <span class="sc">==</span> <span class="dv">2023</span> <span class="sc">&amp;</span> data<span class="sc">$</span>Player <span class="sc">==</span> <span class="st">"Atakan Karazor"</span>] <span class="ot">&lt;-</span> <span class="st">"GER"</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>Nation[data<span class="sc">$</span>Season_End_Year <span class="sc">==</span> <span class="dv">2024</span> <span class="sc">&amp;</span> data<span class="sc">$</span>Player <span class="sc">==</span> <span class="st">"Mahmut Kücüksahin"</span>] <span class="ot">&lt;-</span> <span class="st">"TUR"</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>Nation[data<span class="sc">$</span>Season_End_Year <span class="sc">==</span> <span class="dv">2024</span> <span class="sc">&amp;</span> data<span class="sc">$</span>Player <span class="sc">==</span> <span class="st">"Marco Pellegrino"</span>] <span class="ot">&lt;-</span> <span class="st">"ARG"</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>Nation[data<span class="sc">$</span>Season_End_Year <span class="sc">==</span> <span class="dv">2024</span> <span class="sc">&amp;</span> data<span class="sc">$</span>Player <span class="sc">==</span> <span class="st">"Atakan Karazor"</span>] <span class="ot">&lt;-</span> <span class="st">"GER"</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>Nation[data<span class="sc">$</span>Season_End_Year <span class="sc">==</span> <span class="dv">2025</span> <span class="sc">&amp;</span> data<span class="sc">$</span>Player <span class="sc">==</span> <span class="st">"Atakan Karazor"</span>] <span class="ot">&lt;-</span> <span class="st">"GER"</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>Nation[data<span class="sc">$</span>Season_End_Year <span class="sc">==</span> <span class="dv">2025</span> <span class="sc">&amp;</span> data<span class="sc">$</span>Player <span class="sc">==</span> <span class="st">"Fer López"</span>] <span class="ot">&lt;-</span> <span class="st">"ESP"</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a><span class="co">#Uzupełnienie pozycji</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>Pos[data<span class="sc">$</span>Season_End_Year <span class="sc">==</span> <span class="dv">2018</span> <span class="sc">&amp;</span> data<span class="sc">$</span>Player <span class="sc">==</span> <span class="st">"Christian Rutjens"</span>] <span class="ot">&lt;-</span> <span class="st">"DF"</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a><span class="co">#Uzupełnienie wieku</span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>Age[data<span class="sc">$</span>Season_End_Year <span class="sc">==</span> <span class="dv">2018</span> <span class="sc">&amp;</span> data<span class="sc">$</span>Player <span class="sc">==</span> <span class="st">"Christian Rutjens"</span>] <span class="ot">&lt;-</span> <span class="st">"20"</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>Age[data<span class="sc">$</span>Season_End_Year <span class="sc">==</span> <span class="dv">2024</span> <span class="sc">&amp;</span> data<span class="sc">$</span>Player <span class="sc">==</span> <span class="st">"Marco Pellegrino"</span>] <span class="ot">&lt;-</span> <span class="st">"21"</span></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>Age[data<span class="sc">$</span>Season_End_Year <span class="sc">==</span> <span class="dv">2024</span> <span class="sc">&amp;</span> data<span class="sc">$</span>Player <span class="sc">==</span> <span class="st">"Max Moerstedt"</span>] <span class="ot">&lt;-</span> <span class="st">"18"</span></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>Age[data<span class="sc">$</span>Season_End_Year <span class="sc">==</span> <span class="dv">2025</span> <span class="sc">&amp;</span> data<span class="sc">$</span>Player <span class="sc">==</span> <span class="st">"Fer López"</span>] <span class="ot">&lt;-</span> <span class="st">"25"</span></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>Age[data<span class="sc">$</span>Season_End_Year <span class="sc">==</span> <span class="dv">2024</span> <span class="sc">&amp;</span> data<span class="sc">$</span>Player <span class="sc">==</span> <span class="st">"Max Svensson"</span>] <span class="ot">&lt;-</span> <span class="st">"27"</span></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>Age[data<span class="sc">$</span>Season_End_Year <span class="sc">==</span> <span class="dv">2025</span> <span class="sc">&amp;</span> data<span class="sc">$</span>Player <span class="sc">==</span> <span class="st">"Max Moerstedt"</span>] <span class="ot">&lt;-</span> <span class="st">"19"</span></span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>Age[data<span class="sc">$</span>Season_End_Year <span class="sc">==</span> <span class="dv">2024</span> <span class="sc">&amp;</span> data<span class="sc">$</span>Player <span class="sc">==</span> <span class="st">"Christian Rutjens"</span>] <span class="ot">&lt;-</span> <span class="st">"21"</span></span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>Age[data<span class="sc">$</span>Season_End_Year <span class="sc">==</span> <span class="dv">2025</span> <span class="sc">&amp;</span> data<span class="sc">$</span>Player <span class="sc">==</span> <span class="st">"Pape Daouda Diongue"</span>] <span class="ot">&lt;-</span> <span class="st">"18"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="zmiana-typów" class="level3">
<h3 class="anchored" data-anchor-id="zmiana-typów">4) Zmiana typów</h3>
<p>Typy poszczególnych kolumn:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Wizualizacja 6 pierwszych wierszy</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   20363 obs. of  12 variables:
 $ Season_End_Year    : int  2018 2018 2018 2018 2018 2018 2018 2018 2018 2018 ...
 $ Squad              : chr  "Alavés" "Alavés" "Alavés" "Alavés" ...
 $ Comp               : chr  "La Liga" "La Liga" "La Liga" "La Liga" ...
 $ Player             : chr  "Martin Agirregabiria" "Alexis" "Burgui" "Ermedin Demirović" ...
 $ Nation             : chr  "ESP" "ESP" "ESP" "BIH" ...
 $ Pos                : chr  "DF" "DF" "MF" "FW" ...
 $ Age                : chr  "21" "31" "23" "19" ...
 $ Gls_Standard       : num  0 1 1 1 0 0 1 3 7 3 ...
 $ Sh_Standard        : num  3 13 15 6 3 8 18 24 53 28 ...
 $ Dist_Standard      : num  36.8 13.7 22.6 12.7 25.4 22.7 13.3 19.9 22.2 18.9 ...
 $ xG_Expected        : num  0.1 1.2 0.7 1.7 0.1 0.8 1.2 3.3 4.7 2.7 ...
 $ G_minus_xG_Expected: num  -0.1 -0.2 0.3 -0.7 -0.1 -0.8 -0.2 -0.3 2.3 0.3 ...</code></pre>
</div>
</div>
<p>W kolumnie “Age” lepiej sprawdzi się typ int.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Zmiana typów</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>Age <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(data<span class="sc">$</span>Age)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="tworzenie-dodatkowej-kolumny---age_group" class="level3">
<h3 class="anchored" data-anchor-id="tworzenie-dodatkowej-kolumny---age_group">5) Tworzenie dodatkowej kolumny - Age_Group</h3>
<p>Podczas analizy przyda się także kolumna, która bazowo nie znajduje się w zesrappowanych danych. Będzie ona zawierać informacje na temat grupy wiekowej, w jakiej dany zawodnik się znajduje. Grupy zostały przyznane w następujący sposób:</p>
<p>Junior - 18 lat i poniżej</p>
<p>Bardzo młody - 21 lat i poniżej</p>
<p>Młody - 26 lat i poniżej</p>
<p>Średni - 30 lat i poniżej</p>
<p>Starszy - powyżej 30</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Tworzenie kolumny - Age_Group</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">Age_Group =</span> <span class="fu">case_when</span>(</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>      Age <span class="sc">&lt;=</span> <span class="dv">18</span> <span class="sc">~</span> <span class="st">"Junior (18 i poniżej)"</span>,</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>      Age <span class="sc">&lt;=</span> <span class="dv">21</span> <span class="sc">~</span> <span class="st">"Bardzo młody (21 i poniżej)"</span>,</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>      Age <span class="sc">&lt;=</span> <span class="dv">26</span> <span class="sc">~</span> <span class="st">"Młody (26 i poniżej)"</span>,</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>      Age <span class="sc">&lt;=</span> <span class="dv">30</span> <span class="sc">~</span> <span class="st">"Średni (30 i poniżej)"</span>,</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Starszy (powyżej 30)"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="tworzenie-dodatkowej-ramki" class="level3">
<h3 class="anchored" data-anchor-id="tworzenie-dodatkowej-ramki">6) Tworzenie dodatkowej ramki</h3>
<p>Podczas analizy potrzebna będzie także dodatkowa ramka danych zawierająca dodatkową kolumne “win”. Dodatkowa kolumna będzie dotyczyła tego czy drużyna zawodnika w danym sezonie zakończyła sezon na pozycji 5 lub wyższej. Jeśli tak to w kolumnie win wstawiam wartość true, w przeciwnym wypadku false. W tym przypadku zdecydowałem się na stworzenie dodatkowej ramki a nie dołączenie kolumny do powstałej już ramki, gdyż we wcześniejszej ramce znajdują się obserwacje z obecnego sezonu, który jeszcze się nie skończył. Co za tym idzie nie wiadomo na jakiej pozycji dane kluby skończą sezon. Podczas wizualizacji związanej z kolumną “win” i tak musiałbym stworzyć ramkę pomocniczą, w której odrzuciliłbym obserwacje z tego sezonu. Stąd też decyduje się to zrobić teraz, by nie robić tego potem w głównym pliku, w którym będzie przeprowadzana analiza.</p>
<p>Tworzenie takiej kolumny ręcznie zajęłoby sporo czasu. Dlatego też zdecydowałem się dane potrzebne do stworzenia jej zescrappować ponownie ze strony <a href="https://fbref.com/en/">Fbref</a> i ponownie z pomocą paczki <a href="https://jaseziv.github.io/worldfootballR/articles/extract-fbref-data.html#the-big-5-euro-league-players">worldfootabllR</a></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Stworzenie pustej ramki</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>data_win <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Scrapping</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>seasons <span class="ot">&lt;-</span> <span class="dv">2018</span><span class="sc">:</span><span class="dv">2024</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>countries <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"ENG"</span>, <span class="st">"ESP"</span>, <span class="st">"GER"</span>, <span class="st">"ITA"</span>, <span class="st">"FRA"</span>)</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (country <span class="cf">in</span> countries) {</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (season <span class="cf">in</span> seasons) {</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">Sys.sleep</span>(<span class="dv">5</span>) <span class="co">#Opóźnienie podczas scrappowania danych z różnych podstron w tym przypadku pomaga uniknąć potencjalncyh błędów</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>    help_data <span class="ot">&lt;-</span> <span class="fu">fb_season_team_stats</span>(<span class="at">country=</span>country,<span class="at">gender=</span><span class="st">"M"</span>,<span class="at">season_end_year=</span>season,<span class="at">tier=</span><span class="st">"1st"</span>,<span class="at">stat_type=</span><span class="st">"league_table"</span>)</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>data_win <span class="ot">&lt;-</span> <span class="fu">rbind</span>(data_win, help_data)}}</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a><span class="co">#Usunięcie zbędnych obserwacji</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>data_win <span class="ot">&lt;-</span> data_win <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Rk <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;</span> Rk <span class="sc">&lt;=</span> <span class="dv">5</span>)</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a><span class="co">#Usunięcie zbędnych kolumn</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>data_win <span class="ot">&lt;-</span> data_win <span class="sc">%&gt;%</span> <span class="fu">select</span>(Season_End_Year, Squad)</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a><span class="co">#Dodanie kolumny win</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>data_win <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">win =</span> <span class="fu">ifelse</span>(<span class="fu">paste</span>(Season_End_Year, Squad) <span class="sc">%in%</span> <span class="fu">paste</span>(data_win<span class="sc">$</span>Season_End_Year, data_win<span class="sc">$</span>Squad), <span class="cn">TRUE</span>, <span class="cn">FALSE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="zapis-gotowych-ramek" class="level3">
<h3 class="anchored" data-anchor-id="zapis-gotowych-ramek">7) Zapis gotowych ramek</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Zapis</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(data, <span class="st">"football_data.csv"</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(data_win, <span class="st">"football_data_winners.csv"</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>